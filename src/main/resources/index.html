<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Chat Test</title>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>WebSocket Chat Test</h1>

<input id="senderId" placeholder="Sender ID" value="anonymous"/>
<input id="content" placeholder="Message Content"/>
<button id="sendBtn">Send Message</button>

<h2>Received Messages:</h2>
<ul id="messages"></ul>

<script>
    let stompClient = null;

    function connect() {
        const socket = new SockJS('http://localhost:8080/ws');
        stompClient = Stomp.over(socket);

        stompClient.connect({}, () => {
            console.log('Connected to WebSocket');

            stompClient.subscribe('/topic/public', onMessageReceived);
        }, onError);
    }

    function onError(error) {
        console.error('WebSocket connection error:', error);
    }

    function sendMessage() {
        if (!stompClient || !stompClient.connected) {
            console.error('No connection to server.');
            return;
        }

        const senderId = document.getElementById('senderId').value;
        const content = document.getElementById('content').value;

        const chatMessage = {
            senderId: senderId,
            content: content,
            timestamp: new Date().toISOString()
        };

        stompClient.send("/app/chat", {}, JSON.stringify(chatMessage));

        document.getElementById('content').value = '';
    }

    function onMessageReceived(payload) {
        const message = JSON.parse(payload.body);

        const messageElement = document.createElement('li');
        messageElement.textContent = `[${message.senderId}]: ${message.content}`;

        document.getElementById('messages').appendChild(messageElement);
    }

    document.getElementById('sendBtn').addEventListener('click', sendMessage);

    connect();
</script>
</body>
</html>
